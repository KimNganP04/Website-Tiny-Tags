<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ƒê∆°n h√†ng c·ªßa t√¥i - TinyTags</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --max-w: 1200px; --bg-body: #121212; --bg-card: #242424; --bg-card-hover: #2c2c2c;
      --text-primary: #f1f1f1; --text-secondary: #a0a0a0; --accent: #fe2c55;
      --border-color: rgba(255, 255, 255, 0.08); --radius: 8px;
    }
    body { 
      margin: 0; 
      font-family: 'Inter', system-ui, Arial, sans-serif; 
      background-color: var(--bg-body); 
      color: var(--text-primary);
      min-height: 100vh;
    }
    
    /* ========== HEADER STYLES ========== */
    header.site-header {
      background: #000000;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      position: sticky; top:0; z-index:1200;
      box-shadow: 0 6px 18px rgba(15,23,36,0.04);
    }
    .header-container {
      max-width: var(--max-w);
      margin: 0 auto;
      padding: 12px 18px;
      display: flex; align-items: center; gap: 14px; flex-wrap: wrap;
    }
    .logo img { height: 56px; display: block; }
    
    .search-box { position: relative; flex: 1 1 520px; max-width: 60vw; min-width: 160px; }
    .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: #605f5f; font-size: 1.05rem; pointer-events: none; }
    .search-input {
      width: 100%; height: 44px; padding: 10px 16px 10px 44px; border-radius: 999px;
      border: 1px solid #3e3e3f; background: #ffffff; color: #000000; font-size: 0.95rem;
      outline: none; transition: box-shadow .12s, transform .08s, border-color .12s;
      box-shadow: 0 6px 18px rgba(2,6,23,0.35);
    }
    .search-input::placeholder { color: #5c5a5a; }
    
    .header-right { display: flex; align-items: center; gap: 12px; margin-left: auto; }
    .cart-btn { position: relative; display: inline-flex; align-items: center; justify-content: center; padding: 8px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.03); background: transparent; cursor: pointer; }
    .cart-icon { width: 28px; height: 28px; object-fit: contain; }
    .cart-badge {
      position: absolute; top: -6px; right: -6px; background: var(--accent); color: #fff; min-width: 20px; height: 20px; padding: 0 6px; border-radius: 999px; font-size: 0.75rem; display: inline-flex; align-items: center; justify-content: center;
    }
    
    #user-section { display: flex; align-items: center; gap: 8px; font-family: inherit; }
    .user-name {
      background: #fff; color: #000; padding: 6px 16px;
      border-radius: 20px; font-weight: 600;
      font-family: 'Inter', sans-serif;
    }
    .logout-btn {
      background: transparent; border: 1px solid #fe2c55; color: #fe2c55;
      padding: 6px 12px; border-radius: 20px; font-weight: 600; cursor: pointer;
      font-family: 'Inter', sans-serif;
      transition: all 0.3s ease;
    }
    .logout-btn:hover { background: #fe2c55; color: #fff }
    .login-btn {
      background: transparent; border: 1px solid #fff; color: #fff;
      padding: 6px 16px; border-radius: 20px; font-weight: 600; cursor: pointer;
      font-family: 'Inter', sans-serif;
      transition: all 0.3s ease;
    }
    .login-btn:hover { background: #fff; color: #000 }
    
    nav.main-menu { width: 100%; order: 2; margin-top: 10px; display: flex; justify-content: center; }
    .main-menu ul { display: flex; gap: 24px; list-style: none; margin: 0; padding: 6px 0; align-items: center; flex-wrap: wrap; }
    .main-menu a { color: #eef2f7; font-weight: 700; padding: 6px 8px; text-decoration: none; }
    .main-menu a:hover { color: var(--accent); }
    
    .brand-menu { position: relative; }
    .brand-menu .submenu {
      display: none; position: absolute; left: 0; top: calc(100% + 8px); min-width: 180px;
      background: #000; color: #eef2f7; border-radius: 10px;
      box-shadow: 0 12px 36px rgba(15,23,36,0.08);
      overflow: hidden; z-index: 400;
      transform: translateY(-6px); opacity: 0;
      transition: opacity .12s, transform .12s; pointer-events: none;
    }
    .brand-menu:hover .submenu,
    .brand-menu:focus-within .submenu {
      display: block; transform: translateY(0); opacity: 1; pointer-events: auto;
    }
    .submenu li a {
      display: block; padding: 10px 14px; font-weight: 700; color: #eef2f7 !important;
    }
    .submenu li a:hover { background: #292929; color: #fe2c55 !important; }
    
    /* Back Button */
    .back-container {
      max-width: 1000px;
      margin: 20px auto;
      padding: 0 25px;
    }
    
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: var(--bg-card);
      color: var(--text-primary);
      text-decoration: none;
      border-radius: var(--radius);
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
      font-weight: 600;
    }
    
    .back-btn:hover {
      background: var(--accent);
      color: white;
      transform: translateX(-5px);
    }
    
    main { 
      max-width: 1000px; 
      margin: 0 auto 40px; 
      display: flex; 
      flex-direction: column; 
      gap: 20px; 
      padding: 0 25px;
    }
    
    /* Orders Section */
    .orders-section { 
      background: var(--bg-card); 
      border-radius: var(--radius); 
      padding: 25px; 
    }
    
    .section-title { 
      font-size: 1.5rem; 
      font-weight: 700; 
      margin-bottom: 25px; 
      color: var(--accent); 
    }
    
    .order-card { 
      background: rgba(255,255,255,0.05); 
      border-radius: var(--radius); 
      margin-bottom: 20px; 
      border: 1px solid var(--border-color);
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .order-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(254, 44, 85, 0.2);
    }
    
    .order-header {
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      padding: 20px; 
      background: rgba(0,0,0,0.3);
      border-bottom: 1px solid var(--border-color);
      cursor: pointer;
    }
    
    .order-info { 
      display: flex; 
      gap: 30px; 
      flex-wrap: wrap; 
    }
    
    .info-item { 
      display: flex; 
      flex-direction: column; 
      gap: 5px; 
    }
    
    .info-label { 
      font-size: 0.85rem; 
      color: var(--text-secondary); 
    }
    
    .info-value { 
      font-weight: 600; 
    }
    
    .status-badge {
      padding: 6px 12px; 
      border-radius: 20px; 
      font-size: 0.8rem; 
      font-weight: 600;
    }
    
    .status-pending { background: #fef3c7; color: #92400e; }
    .status-confirmed { background: #d1fae5; color: #065f46; }
    .status-shipping { background: #dbeafe; color: #1e40af; }
    .status-delivered { background: #f3e8ff; color: #6b21a8; }
    .status-cancelled { background: #fee2e2; color: #991b1b; }
    
    .order-content { 
      padding: 0 20px;
      max-height: 0;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .order-content.expanded {
      padding: 20px;
      max-height: 2000px;
    }
    
    .order-items { 
      display: flex; 
      flex-direction: column; 
      gap: 15px; 
      margin-bottom: 20px; 
    }
    
    .order-item {
      display: flex; 
      gap: 15px; 
      padding: 15px;
      background: rgba(255,255,255,0.03); 
      border-radius: 8px;
    }
    
    .order-item img { 
      width: 60px; 
      height: 60px; 
      border-radius: 8px; 
      object-fit: cover; 
    }
    
    .item-details { 
      flex: 1; 
    }
    
    .item-name { 
      font-weight: 600; 
      margin-bottom: 5px; 
    }
    
    .item-meta { 
      font-size: 0.85rem; 
      color: var(--text-secondary); 
    }
    
    .item-price { 
      font-weight: 600; 
      color: var(--accent); 
    }
    
    /* Order Timeline */
    .order-timeline {
      margin: 25px 0;
      padding: 20px;
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      position: relative;
    }
    
    .timeline-title {
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--accent);
    }
    
    .timeline-steps {
      display: flex;
      justify-content: space-between;
      position: relative;
    }
    
    .timeline-steps::before {
      content: '';
      position: absolute;
      top: 15px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--border-color);
      z-index: 1;
    }
    
    .timeline-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
      flex: 1;
    }
    
    .step-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--border-color);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 8px;
      transition: all 0.3s ease;
    }
    
    .step-icon.active {
      background: var(--accent);
    }
    
    .step-icon.completed {
      background: #10b981;
    }
    
    .step-label {
      font-size: 0.8rem;
      text-align: center;
      color: var(--text-secondary);
      transition: all 0.3s ease;
    }
    
    .step-label.active {
      color: var(--accent);
      font-weight: 600;
    }
    
    .step-label.completed {
      color: #10b981;
    }
    
    .step-date {
      font-size: 0.7rem;
      color: var(--text-secondary);
      margin-top: 4px;
    }
    
    /* Order Details Expanded */
    .order-details-expanded {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-top: 20px;
    }
    
    .detail-section {
      background: rgba(255,255,255,0.03);
      padding: 20px;
      border-radius: 8px;
    }
    
    .detail-section h4 {
      margin: 0 0 15px 0;
      color: var(--accent);
      font-size: 1rem;
    }
    
    .detail-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .detail-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .detail-label {
      color: var(--text-secondary);
    }
    
    .detail-value {
      font-weight: 600;
      text-align: right;
    }
    
    .payment-proof {
      max-width: 200px;
      margin-top: 10px;
    }
    
    .payment-proof img {
      width: 100%;
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }
    
    .order-summary {
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      padding-top: 20px; 
      border-top: 1px solid var(--border-color);
      margin-top: 20px;
    }
    
    .total-amount { 
      font-size: 1.2rem; 
      font-weight: 700; 
      color: var(--accent); 
    }
    
    .order-actions {
      display: flex; 
      gap: 10px; 
      margin-top: 15px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 8px 16px; 
      border: none; 
      border-radius: 6px;
      cursor: pointer; 
      font-weight: 600; 
      transition: all 0.3s ease;
      font-family: 'Inter', sans-serif;
      font-size: 0.85rem;
    }
    
    .btn-primary {
      background: var(--accent); 
      color: white;
    }
    
    .btn-primary:hover {
      background: #e0264d; 
      transform: translateY(-1px);
    }
    
    .btn-secondary {
      background: transparent; 
      border: 1px solid var(--border-color); 
      color: var(--text-primary);
    }
    
    .btn-secondary:hover {
      background: rgba(255,255,255,0.05);
    }
    
    .btn-danger {
      background: #dc2626; 
      color: white;
    }
    
    .btn-danger:hover {
      background: #b91c1c;
    }
    
    .empty-state {
      text-align: center; 
      padding: 60px 20px; 
      color: var(--text-secondary);
    }
    
    .empty-state i { 
      font-size: 4rem; 
      margin-bottom: 20px; 
      color: var(--border-color); 
    }
    
    .chevron-icon {
      transition: transform 0.3s ease;
    }
    
    .chevron-icon.rotated {
      transform: rotate(180deg);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .header-container {
        flex-direction: column;
        gap: 10px;
      }
      
      .search-box {
        max-width: 100%;
        order: 3;
      }
      
      .main-menu ul {
        gap: 12px;
      }
      
      .main-menu a {
        font-size: 0.8rem;
        padding: 6px 8px;
      }
      
      .back-container {
        padding: 0 15px;
      }
      
      main {
        padding: 0 15px;
      }
      
      .orders-section {
        padding: 20px;
      }
      
      .order-header { 
        flex-direction: column; 
        gap: 15px; 
        align-items: flex-start; 
      }
      
      .order-info { 
        gap: 15px; 
      }
      
      .order-summary { 
        flex-direction: column; 
        gap: 15px; 
        align-items: flex-start; 
      }
      
      .order-actions { 
        flex-wrap: wrap; 
      }
      
      .order-details-expanded { 
        grid-template-columns: 1fr; 
        gap: 20px; 
      }
      
      .timeline-steps { 
        flex-direction: column; 
        gap: 20px; 
      }
      
      .timeline-steps::before { 
        display: none; 
      }
      
      .timeline-step { 
        flex-direction: row; 
        justify-content: flex-start; 
        gap: 15px; 
      }
      
      .step-icon { 
        margin-bottom: 0; 
      }
      
      .step-label { 
        text-align: left; 
      }
    }
  </style>
</head>
<body>

  <header class="site-header">
    <div class="header-container">
      <div class="logo">
        <a href="index.html"><img src="H√¨nh/LOGO/logo tinytags.png" alt="Logo"></a>
      </div>
      <div class="search-box" role="search">
        <i class="fa-solid fa-magnifying-glass search-icon"></i>
        <input class="search-input" type="search" placeholder="T√¨m s·∫£n ph·∫©m, th∆∞∆°ng hi·ªáu..." id="header-search">
        <div class="search-results" id="search-results"></div>
      </div>
      <div class="header-right">
        <a href="cart.html" class="cart-btn">
          <img class="cart-icon" src="H√¨nh/CART/shopping-cart-304843_1280.webp" alt="Gi·ªè h√†ng">
          <span class="cart-badge" id="cartCount" style="display:none">0</span>
        </a>
        <div id="user-section"></div>
      </div>
      <nav class="main-menu">
        <ul>
          <li><a href="index.html">TRANG CH·ª¶</a></li>
          <li><a href="Introduce.html">GI·ªöI THI·ªÜU</a></li>
          <li class="brand-menu">
            <a href="store.html">C·ª¨A H√ÄNG</a>
          </li>
          <li><a href="livestream.html">TRANG LIVESTREAM</a></li>
          <li><a href="hopthoai.html">H·ªòP THO·∫†I</a></li>
          <li><a href="thongbao.html">TH√îNG B√ÅO</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- N√∫t quay l·∫°i trang ch·ªß -->
  <div class="back-container">
    <a href="index.html" class="back-btn">
      <i class="fas fa-arrow-left"></i>
      Quay l·∫°i trang ch·ªß
    </a>
  </div>

  <main>
    <section class="orders-section">
        <h1 class="section-title">ƒê∆°n h√†ng c·ªßa t√¥i</h1>
        <div id="orders-container">
            <div class="empty-state" id="empty-state">
                <i class="fas fa-box-open"></i>
                <h3>Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</h3>
                <p>H√£y mua s·∫Øm v√† quay l·∫°i ƒë·ªÉ theo d√µi ƒë∆°n h√†ng c·ªßa b·∫°n</p>
                <a href="store.html" class="btn btn-primary" style="margin-top: 15px;">Mua s·∫Øm ngay</a>
            </div>
            <div id="orders-list"></div>
        </div>
    </section>
  </main>
<style>
    /* ========== FOOTER ========== */
    footer {
      margin-top: 80px;
    }
    
    .footer-container {
      background-color: #000000; 
      color: #ffffff; 
      padding: 20px 20px; 
      display: flex; 
      justify-content: space-around; 
      align-items: flex-start; 
      flex-wrap: wrap; 
      text-align: center;
    }
    
    .footer-logo, .footer-info, .footer-license, .footer-payment {
      flex: 1;
      min-width: 250px;
      margin-bottom: 20px;
      padding: 0 15px;
    }
    
    .footer-logo img {
      height: 100px;
      margin-bottom: 10px;
    }
    
    .footer-container h3 {
      margin: 0 0 15px;
      font-size: 1.2rem;
      font-weight: 700;
    }
    
    .footer-container p {
      margin: 8px 0;
      font-size: 0.9rem;
      color: #a0aec0;
    }
  </style>

  <footer>
    <div class="footer-container">
      <div class="footer-logo">
        <img src="H√¨nh/LOGO/logo tinytags.png" alt="tiny tags">
      </div>
      <div class="footer-info">
        <h3>TH√îNG TIN LI√äN H·ªÜ</h3>
        <p><strong>TINY TAGS</strong></p>
        <p>ƒê·ªãa ch·ªâ: Khu ph·ªë 6, ph∆∞·ªùng Linh Trung, <br>
          TP Th·ªß ƒê·ª©c, TP H·ªì Ch√≠ Minh</p>
        <p>Email: tinytags.store@gmail.com</p>
      </div>
      <div class="footer-license">
        <h3>H·ªñ TR·ª¢ KH√ÅCH H√ÄNG</h3>
        <p>ChƒÉm s√≥c kh√°ch h√†ng</p>
        <p>H∆∞·ªõng d·∫´n mua h√†ng</p>
        <p>H·ªó tr·ª£ ƒë·ªïi tr·∫£ h√†ng</p>
      </div>
      <div class="footer-payment">
        <h3>CH√çNH S√ÅCH</h3>
        <p>Ch√≠nh s√°ch ƒë·ªïi h√†ng</p>
        <p>B·∫£o m·∫≠t th√¥ng tin</p>
        <p>Ch√≠nh s√°ch giao h√†ng</p>
      </div>
    </div>
  </footer>

<script>

  // firebase
  
  // ========== USER SECTION MANAGEMENT ==========
  function esc(s){ return String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  function updateUserSection(){
    const root = document.getElementById("user-section");
    const user = JSON.parse(localStorage.getItem("user")) || null;
    
    const userName = user ? (user.username || user.fullname) : null;
    
    if(user && userName){
      root.innerHTML = `
        <span class="user-name">Xin ch√†o, ${esc(userName)}</span>
        <button class="logout-btn" id="logoutBtn">ƒêƒÉng xu·∫•t</button>
      `;
      document.getElementById("logoutBtn").addEventListener("click", ()=>{
        localStorage.removeItem("user");
        updateUserSection();
        showToast("ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng!");
      });
    }else{
      root.innerHTML = `<a href="login.html" class="login-btn">ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</a>`;
    }
  }

  // H√†m hi·ªÉn th·ªã toast
  function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.innerHTML = `
      <i class="fas fa-${type === 'success' ? 'check' : 'exclamation'}-circle"></i>
      ${message}
    `;
    document.body.appendChild(toast);
    
    setTimeout(() => {
      if (toast.parentNode) {
        document.body.removeChild(toast);
      }
    }, 3000);
  }

  function updateCartCount() {
    try {
      const user = JSON.parse(localStorage.getItem("user")) || null;
      const rawCart = JSON.parse(localStorage.getItem("cart")) || [];
      let totalQty = 0;
      if (user && (user.fullname || user.username)) {
        const username = user.fullname || user.username;
        rawCart.forEach(it => { 
          if (it.username === username) totalQty += Number(it.quantity||1); 
        });
      }
      const badge = document.getElementById("cartCount");
      if (!badge) return;
      if (totalQty > 0) {
        badge.style.display = 'inline-flex';
        badge.textContent = totalQty;
      } else {
        badge.style.display = 'none';
      }
    } catch(e){ /* ignore */ }
  }

  // ========== ORDER MANAGEMENT ==========
  function formatOrderDate(dateString) {
    if (!dateString) return 'ƒêang c·∫≠p nh·∫≠t';
    
    try {
        const date = new Date(dateString);
        if (isNaN(date.getTime())) {
            return dateString;
        }
        
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        
        return `${hours}:${minutes} ${day}/${month}/${year}`;
    } catch (error) {
        return dateString;
    }
  }

  function getStatusText(status) {
    const statusMap = {
      'pending': 'Ch·ªù x√°c nh·∫≠n',
      'confirmed': 'ƒê√£ x√°c nh·∫≠n',
      'shipping': 'ƒêang giao h√†ng',
      'delivered': 'ƒê√£ giao h√†ng',
      'cancelled': 'ƒê√£ h·ªßy'
    };
    return statusMap[status] || status;
  }

  function getPaymentText(payment) {
    const paymentMap = {
      'cod': 'Thanh to√°n khi nh·∫≠n h√†ng',
      'momo': 'V√≠ MoMo',
      'vnpay': 'V√≠ VNPay',
      'bank': 'Th·∫ª ng√¢n h√†ng',
      'transfer': 'Chuy·ªÉn kho·∫£n ng√¢n h√†ng'
    };
    return paymentMap[payment] || payment;
  }

  function getTimelineSteps(order) {
    const steps = [
      { id: 'ordered', label: 'ƒê·∫∑t h√†ng th√†nh c√¥ng', icon: 'fas fa-shopping-cart', date: order.createdAt },
      { id: 'confirmed', label: 'ƒê√£ x√°c nh·∫≠n', icon: 'fas fa-check-circle', date: order.confirmedAt },
      { id: 'shipping', label: 'ƒêang giao h√†ng', icon: 'fas fa-shipping-fast', date: order.shippedAt },
      { id: 'delivered', label: 'Giao h√†ng th√†nh c√¥ng', icon: 'fas fa-box-open', date: order.deliveredAt }
    ];
    
    if (order.status === 'cancelled') {
      return steps.map(step => ({
        ...step,
        status: 'cancelled'
      }));
    }
    
    const statusOrder = ['pending', 'confirmed', 'shipping', 'delivered'];
    const currentStatusIndex = statusOrder.indexOf(order.status);
    
    return steps.map((step, index) => {
      let status = 'pending';
      if (index <= currentStatusIndex) {
        status = index === currentStatusIndex ? 'active' : 'completed';
      }
      
      return {
        ...step,
        status: status,
        date: step.date
      };
    });
  }

  function toggleOrderDetails(orderId) {
    const content = document.getElementById(`order-content-${orderId}`);
    const chevron = document.getElementById(`chevron-${orderId}`);
    
    if (!content || !chevron) return;
    
    if (content.classList.contains('expanded')) {
      content.classList.remove('expanded');
      chevron.classList.remove('rotated');
    } else {
      // ƒê√≥ng t·∫•t c·∫£ c√°c order kh√°c ƒëang m·ªü
      document.querySelectorAll('.order-content.expanded').forEach(el => {
        if (el.id !== `order-content-${orderId}`) {
          el.classList.remove('expanded');
          const otherChevron = document.getElementById(el.id.replace('order-content-', 'chevron-'));
          if (otherChevron) otherChevron.classList.remove('rotated');
        }
      });
      
      content.classList.add('expanded');
      chevron.classList.add('rotated');
    }
  }

  // H√ÄM CH√çNH - ƒê√É S·ª¨A L·ªñI AUTO RELOAD V√Ä USERNAME MATCHING
  function loadMyOrders() {
    console.log('üîÑ ƒêang t·∫£i ƒë∆°n h√†ng...');
    
    const user = JSON.parse(localStorage.getItem("user"));
    
    // KI·ªÇM TRA ƒêƒÇNG NH·∫¨P
    if (!user) {
      document.getElementById("empty-state").innerHTML = `
        <i class="fas fa-user-slash"></i>
        <h3>Vui l√≤ng ƒëƒÉng nh·∫≠p</h3>
        <p>B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ xem ƒë∆°n h√†ng c·ªßa m√¨nh</p>
        <a href="login.html" class="btn btn-primary" style="margin-top: 15px;">ƒêƒÉng nh·∫≠p ngay</a>
      `;
      document.getElementById("empty-state").style.display = 'block';
      document.getElementById("orders-list").innerHTML = '';
      return;
    }
    
    // ƒê·ªåC T·ª™ C·∫¢ adminOrders V√Ä userOrders ƒê·ªÇ ƒê·∫¢M B·∫¢O HI·ªÇN TH·ªä
    const adminOrders = JSON.parse(localStorage.getItem("adminOrders")) || [];
    const userOrders = JSON.parse(localStorage.getItem("userOrders")) || {};
    const username = user.fullname || user.username;
    
    console.log('üì¶ T·∫•t c·∫£ ƒë∆°n h√†ng t·ª´ admin:', adminOrders);
    console.log('üë§ Username hi·ªán t·∫°i:', username);
    
    // L·ªçc ƒë∆°n h√†ng c·ªßa user hi·ªán t·∫°i - ƒê√É S·ª¨A L·ªñI USERNAME MATCHING
    let myOrders = [];
    
    // 1. T·ª´ adminOrders - ki·ªÉm tra nhi·ªÅu tr∆∞·ªùng h·ª£p username
    adminOrders.forEach(order => {
      const customerName = order.customerInfo?.name;
      console.log(`üîç Ki·ªÉm tra ƒë∆°n h√†ng ${order.orderId}:`, {
        customerName: customerName,
        username: username,
        match: customerName === username
      });
      
      // FIX: So s√°nh username v·ªõi c·∫£ customerName v√† username trong order
      if (customerName === username || 
          order.customerInfo?.username === username ||
          (userOrders[username] && userOrders[username].some(o => o.orderId === order.orderId))) {
        myOrders.push(order);
      }
    });
    
    // 2. T·ª´ userOrders - backup
    if (userOrders[username]) {
      userOrders[username].forEach(order => {
        if (!myOrders.some(o => o.orderId === order.orderId)) {
          myOrders.push(order);
        }
      });
    }
    
    console.log('‚úÖ ƒê∆°n h√†ng c·ªßa t√¥i sau khi l·ªçc:', myOrders);
    
    if (myOrders.length === 0) {
      document.getElementById("empty-state").style.display = 'block';
      document.getElementById("orders-list").innerHTML = '';
      return;
    }
    
    document.getElementById("empty-state").style.display = 'none';
    
    // S·∫Øp x·∫øp ƒë∆°n h√†ng m·ªõi nh·∫•t l√™n ƒë·∫ßu
    myOrders.sort((a, b) => {
      const dateA = new Date(a.createdAt || a.timestamp || 0);
      const dateB = new Date(b.createdAt || b.timestamp || 0);
      return dateB - dateA;
    });
    
    let ordersHtml = '';
    
    myOrders.forEach(order => {
      console.log('üìã X·ª≠ l√Ω ƒë∆°n h√†ng:', order);
      
      const statusClass = `status-${order.status || 'pending'}`;
      const statusText = getStatusText(order.status || 'pending');
      const paymentMethod = order.payment?.method || 'cod';
      const paymentText = getPaymentText(paymentMethod);
      const timelineSteps = getTimelineSteps(order);
      
      // X·ª≠ l√Ω items
      const items = order.items || [];
      let itemsHtml = '';
      
      if (items.length === 0) {
        itemsHtml = '<div class="order-item"><div class="item-details">Kh√¥ng c√≥ th√¥ng tin s·∫£n ph·∫©m</div></div>';
      } else {
        items.forEach(item => {
          const itemName = item.name || 'S·∫£n ph·∫©m kh√¥ng t√™n';
          const itemImage = item.image || 'https://via.placeholder.com/60x60?text=No+Image';
          const itemSize = item.size || 'N/A';
          const itemQuantity = item.quantity || 1;
          const itemPrice = item.price || 0;
          
          itemsHtml += `
            <div class="order-item">
              <img src="${itemImage}" alt="${itemName}" onerror="this.src='https://via.placeholder.com/60x60?text=No+Image'">
              <div class="item-details">
                <div class="item-name">${itemName}</div>
                <div class="item-meta">Ph√¢n lo·∫°i: ${itemSize} | S·ªë l∆∞·ª£ng: ${itemQuantity}</div>
              </div>
              <div class="item-price">${parseInt(itemPrice * itemQuantity).toLocaleString('vi-VN')}‚Ç´</div>
            </div>
          `;
        });
      }
      
      // Timeline HTML
      let timelineHtml = '';
      timelineSteps.forEach(step => {
        timelineHtml += `
          <div class="timeline-step">
            <div class="step-icon ${step.status}">
              <i class="${step.icon}" style="font-size: 0.8rem; color: ${step.status === 'pending' ? '#6b7280' : 'white'}"></i>
            </div>
            <div class="step-label ${step.status}">${step.label}</div>
            ${step.date ? `<div class="step-date">${formatOrderDate(step.date)}</div>` : ''}
          </div>
        `;
      });
      
      // Th√¥ng tin kh√°ch h√†ng
      const customerInfo = order.customerInfo || {};
      const customerName = customerInfo.name || 'Kh√¥ng c√≥ th√¥ng tin';
      const customerPhone = customerInfo.phone || 'Kh√¥ng c√≥ th√¥ng tin';
      const customerAddress = customerInfo.address || 'Kh√¥ng c√≥ th√¥ng tin';
      
      // Th√¥ng tin thanh to√°n
      const paymentStatus = order.payment?.status || 'pending';
      const transactionId = order.payment?.transactionId || '';
      
      // T·ªïng ti·ªÅn
      const totalAmount = order.orderSummary?.total || order.total || 0;
      
      let actionsHtml = '';
      if (order.status === 'pending') {
        actionsHtml = `
          <button class="btn btn-danger" onclick="cancelOrder('${order.orderId}')">H·ªßy ƒë∆°n h√†ng</button>
          <button class="btn btn-secondary" onclick="contactSupport('${order.orderId}')">Li√™n h·ªá h·ªó tr·ª£</button>
        `;
      } else if (order.status === 'shipping') {
        actionsHtml = `
          <button class="btn btn-primary" onclick="trackOrder('${order.orderId}')">Theo d√µi ƒë∆°n h√†ng</button>
        `;
      } else if (order.status === 'delivered') {
        actionsHtml = `
          <button class="btn btn-primary" onclick="buyAgain('${order.orderId}')">Mua l·∫°i</button>
          <button class="btn btn-secondary" onclick="rateOrder('${order.orderId}')">ƒê√°nh gi√°</button>
        `;
      } else {
        actionsHtml = `
          <button class="btn btn-secondary" onclick="contactSupport('${order.orderId}')">Li√™n h·ªá CSKH</button>
        `;
      }
      
      ordersHtml += `
        <div class="order-card">
          <div class="order-header" onclick="toggleOrderDetails('${order.orderId}')">
            <div class="order-info">
              <div class="info-item">
                <span class="info-label">M√£ ƒë∆°n h√†ng</span>
                <span class="info-value">${order.orderId}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Ng√†y ƒë·∫∑t</span>
                <span class="info-value">${formatOrderDate(order.createdAt)}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Ph∆∞∆°ng th·ª©c</span>
                <span class="info-value">${paymentText}</span>
              </div>
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
              <span class="status-badge ${statusClass}">${statusText}</span>
              <i class="fas fa-chevron-down chevron-icon" id="chevron-${order.orderId}"></i>
            </div>
          </div>
          
          <div class="order-content" id="order-content-${order.orderId}">
            <div class="order-items">
              ${itemsHtml}
            </div>
            
            <!-- Timeline -->
            <div class="order-timeline">
              <div class="timeline-title">Ti·∫øn tr√¨nh ƒë∆°n h√†ng</div>
              <div class="timeline-steps">
                ${timelineHtml}
              </div>
            </div>
            
            <!-- Chi ti·∫øt ƒë∆°n h√†ng m·ªü r·ªông -->
            <div class="order-details-expanded">
              <div class="detail-section">
                <h4>Th√¥ng tin giao h√†ng</h4>
                <div class="detail-item">
                  <span class="detail-label">Ng∆∞·ªùi nh·∫≠n:</span>
                  <span class="detail-value">${customerName}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">ƒêi·ªán tho·∫°i:</span>
                  <span class="detail-value">${customerPhone}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">ƒê·ªãa ch·ªâ:</span>
                  <span class="detail-value">${customerAddress}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Ph∆∞∆°ng th·ª©c v·∫≠n chuy·ªÉn:</span>
                  <span class="detail-value">Giao h√†ng nhanh</span>
                </div>
              </div>
              
              <div class="detail-section">
                <h4>Th√¥ng tin thanh to√°n</h4>
                <div class="detail-item">
                  <span class="detail-label">Ph∆∞∆°ng th·ª©c:</span>
                  <span class="detail-value">${paymentText}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Tr·∫°ng th√°i thanh to√°n:</span>
                  <span class="detail-value">${paymentStatus === 'paid' ? 'ƒê√£ thanh to√°n' : 'Ch∆∞a thanh to√°n'}</span>
                </div>
                ${transactionId ? `
                <div class="detail-item">
                  <span class="detail-label">M√£ giao d·ªãch:</span>
                  <span class="detail-value">${transactionId}</span>
                </div>
                ` : ''}
              </div>
            </div>
            
            <!-- T·ªïng thanh to√°n -->
            <div class="order-summary">
              <div>
                <div class="info-label">T·ªïng thanh to√°n</div>
                <div class="total-amount">${parseInt(totalAmount).toLocaleString('vi-VN')}‚Ç´</div>
              </div>
              <div class="order-actions">
                ${actionsHtml}
              </div>
            </div>
            
            ${order.note ? `
            <div class="detail-section">
              <h4>Ghi ch√∫</h4>
              <p>${order.note}</p>
            </div>
            ` : ''}
          </div>
        </div>
      `;
    });
    
    document.getElementById("orders-list").innerHTML = ordersHtml;
    
    // T·ª± ƒë·ªông m·ªü ƒë∆°n h√†ng t·ª´ URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const orderId = urlParams.get('orderId');
    if (orderId) {
      setTimeout(() => {
        toggleOrderDetails(orderId);
        const orderElement = document.getElementById(`order-content-${orderId}`);
        if (orderElement) {
          orderElement.scrollIntoView({ 
            behavior: 'smooth',
            block: 'center'
          });
        }
      }, 500);
    }
  }

  function cancelOrder(orderId) {
    if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy ƒë∆°n h√†ng ${orderId}?`)) {
      // H·ªßy trong adminOrders
      const adminOrders = JSON.parse(localStorage.getItem("adminOrders")) || [];
      const orderIndex = adminOrders.findIndex(order => order.orderId === orderId);
      
      if (orderIndex !== -1) {
        adminOrders[orderIndex].status = 'cancelled';
        adminOrders[orderIndex].cancelledAt = new Date().toISOString();
        localStorage.setItem("adminOrders", JSON.stringify(adminOrders));
        
        // T·∫°o th√¥ng b√°o
        createNotification(orderId, 'cancelled');
        
        loadMyOrders();
        alert('ƒê√£ h·ªßy ƒë∆°n h√†ng th√†nh c√¥ng!');
      }
    }
  }

  function createNotification(orderId, type) {
    const notifications = JSON.parse(localStorage.getItem("userNotifications")) || [];
    const user = JSON.parse(localStorage.getItem("user"));
    const username = user.fullname || user.username;
    
    let title = '';
    let message = '';
    
    switch(type) {
      case 'cancelled':
        title = 'ƒê∆°n h√†ng ƒë√£ b·ªã h·ªßy';
        message = `ƒê∆°n h√†ng ${orderId} ƒë√£ b·ªã h·ªßy theo y√™u c·∫ßu c·ªßa b·∫°n.`;
        break;
      case 'status_updated':
        title = 'C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng';
        message = `ƒê∆°n h√†ng ${orderId} ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t tr·∫°ng th√°i.`;
        break;
    }
    
    const notification = {
      id: 'TB' + Date.now(),
      type: 'order_update',
      title: title,
      message: message,
      time: new Date().toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' }),
      date: new Date(),
      orderId: orderId,
      read: false,
      icon: 'fas fa-shopping-cart'
    };
    
    notifications.unshift(notification);
    localStorage.setItem("userNotifications", JSON.stringify(notifications));
  }

  function contactSupport(orderId) {
    alert(`Li√™n h·ªá h·ªó tr·ª£ cho ƒë∆°n h√†ng ${orderId}\n\nEmail: tinytags.store@gmail.com\nZalo: 0782511460`);
  }

  function trackOrder(orderId) {
    alert(`Theo d√µi ƒë∆°n h√†ng ${orderId}\n\nƒê∆°n h√†ng ƒëang ƒë∆∞·ª£c v·∫≠n chuy·ªÉn. B·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c th√¥ng b√°o khi h√†ng s·∫Øp ƒë·∫øn.\n\nM√£ v·∫≠n ƒë∆°n: VN${orderId}`);
  }

  function buyAgain(orderId) {
    const adminOrders = JSON.parse(localStorage.getItem("adminOrders")) || [];
    const order = adminOrders.find(o => o.orderId === orderId);
    const user = JSON.parse(localStorage.getItem("user"));
    const username = user.fullname || user.username;
    
    if (order && order.items) {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      
      order.items.forEach(item => {
        const existingItem = cart.find(cartItem => 
          cartItem.id === item.id && 
          cartItem.size === item.size && 
          cartItem.username === username
        );
        
        if (existingItem) {
          existingItem.quantity += item.quantity || 1;
        } else {
          cart.push({
            ...item,
            username: username
          });
        }
      });
      
      localStorage.setItem("cart", JSON.stringify(cart));
      alert('ƒê√£ th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng!');
      window.location.href = 'cart.html';
    }
  }

  function rateOrder(orderId) {
    alert(`ƒê√°nh gi√° ƒë∆°n h√†ng ${orderId}\n\nChuy·ªÉn h∆∞·ªõng ƒë·∫øn trang ƒë√°nh gi√°...`);
  }

  // KH·ªûI T·∫†O TRANG
  document.addEventListener("DOMContentLoaded", () => {
    console.log('üöÄ Trang ƒë∆°n h√†ng ƒë√£ t·∫£i xong');
    
    // C·∫≠p nh·∫≠t header - GI·ªêNG TRANG THANH TO√ÅN
    updateUserSection();
    updateCartCount();
    
    // T·∫£i ƒë∆°n h√†ng - CH·ªà M·ªòT L·∫¶N
    loadMyOrders();
  });

  // L·∫ÆNG NGHE THAY ƒê·ªîI T·ª™ ADMIN V√Ä USER
  window.addEventListener("storage", (e) => { 
    if (e.key === "adminOrders") {
      console.log('üîÑ Ph√°t hi·ªán thay ƒë·ªïi t·ª´ admin, t·∫£i l·∫°i ƒë∆°n h√†ng...');
      loadMyOrders();
    } else if (e.key === "user") {
      console.log('üîÑ Ph√°t hi·ªán thay ƒë·ªïi user, c·∫≠p nh·∫≠t header...');
      updateUserSection();
      updateCartCount();
      loadMyOrders();
    } else if (e.key === "cart") {
      updateCartCount();
    }
  });

  // ƒê√É X√ìA setInterval ƒë·ªÉ tr√°nh auto reload
</script>
</body>
</html>